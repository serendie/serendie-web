---
import Code from "@/components/Code.astro";
import { useTranslations, type Language, getLangFromUrl } from "@/i18n/utils";
import type { BundledLanguage } from "shiki";

interface Props {
  title?: string;
  description?: string;
  titleKey?: string;
  descriptionKey?: string;
  code?: string;
  storyPath?: string;
  language?: BundledLanguage;
}

const {
  title,
  description,
  titleKey,
  descriptionKey,
  code,
  storyPath,
  language,
} = Astro.props as Props;

const lang =
  (Astro.props as Props & { lang?: Language })?.lang ??
  (getLangFromUrl(Astro.url) as Language);
const t = useTranslations(lang);

const translate = (key: string | undefined, fallback?: string) => {
  if (!key) return fallback ?? "";
  const translated = t(key as any);
  return translated ?? fallback ?? key;
};
---

<Code
  title={translate(titleKey, title)}
  description={translate(descriptionKey, description)}
  code={code}
  storyPath={storyPath}
  language={language}
>
  <slot />
</Code>
