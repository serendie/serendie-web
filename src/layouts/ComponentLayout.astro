---
import "@/index.css";
import { getCollection, type CollectionEntry } from "astro:content";
import Global from "./Global.astro";
import { SideMenu } from "../components/SideMenu";
import { Main, MainGrid } from "@/components/Main";
import PageHeader from "@/components/PageHeader.astro";
import { IndexPageHeader } from "@/components/IndexPageHeader";
import { css } from "styled-system/css";
import { PageMain } from "@/components/PageLayout";
import { getLangFromUrl, useLocalePath } from "@/i18n/utils";

interface Props {
  data: CollectionEntry<"components">["data"];
}

const { data } = Astro.props;
const components = await getCollection("components");
const lang = getLangFromUrl(Astro.url);
const localePath = useLocalePath(lang);
const description =
  lang === "en" && data.descriptionEn ? data.descriptionEn : data.description;
const componentName = lang === "ja" ? data.componentName : undefined;

const componentLinks = components
  .map((component) => {
    const href = localePath(`components/${component.slug}`);
    return {
      href,
      title: component.data.title,
      isActive:
        component.data.title === data.title &&
        Astro.url.pathname.replace(/\/$/, "") === href.replace(/\/$/, ""),
    };
  })
  .sort((a, b) => a.title.localeCompare(b.title));

componentLinks.unshift({
  href: localePath("components"),
  title: "Components",
  isActive:
    Astro.url.pathname.replace(/\/$/, "") ===
    localePath("components").replace(/\/$/, ""),
});
---

<Global title={data.title}>
  <MainGrid>
    <SideMenu links={componentLinks} client:idle />
    <Main
      className={css({
        display: "grid",
        gridTemplateColumns: "repeat(8, 1fr)",
        columnGap: "40px",
        mdDown: {
          gridTemplateColumns: "1fr",
          px: "24px",
        },
      })}
    >
      <PageHeader hideBorder={Astro.url.pathname === "/components"} links={[]}>
        <IndexPageHeader
          title={data.title}
          subTitle={componentName}
          illustType="D"
          illustSize={data.illustSize}
          lastUpdated={data.lastUpdated}
          description={description}
          lang={lang}
        />
      </PageHeader>
      <PageMain>
        <slot />
      </PageMain>
    </Main>
  </MainGrid>
</Global>
