---
import { Button, SvgIcon } from "@spread/ui";
import { Box, Flex, styled } from "@spread/ui/jsx";
import { Code as AstroCode } from "astro:components";
import type { BundledLanguage } from "shiki";
import { StorybookButton } from "../comopnents/StorybookButton.tsx";
import { css } from "@spread/ui/css";

interface Props {
  title: string;
  description: string;
  code: string;
  storyUrl?: string;
  language?: BundledLanguage;
}

const {
  title, 
  description,
  code,
  storyUrl,
  language
} = Astro.props

const Container = styled('div',{
  base: {
    textStyle: "dic.system.typography.body.small_expanded",
    mb:"dic.system.dimension.spacing.threeExtraLarge",
  }
})

const SubTitle = styled('h2',{
  base: {
    textStyle: "dic.system.typography.title.large_expanded",
  }
})

const Description = styled('p',{
  base: {
    mb: "dic.system.dimension.spacing.medium",
  }
})

const StyledButton = styled('button', {
  base: {
    cursor: "pointer",
  }
})

---

<Container>
  <Flex justifyContent={"space-between"} mb="dic.system.dimension.spacing.small">
    <SubTitle>{title}</SubTitle>
    <StorybookButton href={storyUrl} />
  </Flex>
  <Description mb="dic.system.dimension.spacing.twoExtraLarge" fontSize="dic.reference.typography.scale.expanded.extraSmall">{description}</Description>
  <Box border={"solid"} borderColor="dic.system.color.component.outline" borderWidth="dic.system.dimension.border.medium" borderRadius='dic.system.dimension.radius.large' overflow='hidden'>
    <Box p='dic.system.dimension.spacing.threeExtraLarge' borderBottomColor="dic.system.color.component.outline" borderBottomWidth="dic.system.dimension.border.medium"> 
      <slot />
    </Box>
    <Box py='dic.system.dimension.spacing.extraLarge' px='dic.system.dimension.spacing.twoExtraLarge' bg="dic.reference.color.scale.gray.100">
      <Flex justifyContent={"space-between"} py='dic.system.dimension.spacing.small' px='dic.system.dimension.spacing.extraSmall'>
        <StyledButton data-toggle-code display="inline-flex" alignItems={"center"} textStyle="dic.system.typography.body.medium_expanded">
          <SvgIcon icon={"chevron_right"} size={"20px"} className={css({mr:"dic.system.dimension.spacing.extraSmall"})} />
          Code
        </StyledButton>
        <StyledButton aria-label="Copy"><SvgIcon size={"20px"} icon={"clipboard_copy"}/></StyledButton>
      </Flex>
      <Box style={{"display": "none"}} pt="dic.system.dimension.spacing.medium" px="dic.system.dimension.spacing.medium" fontSize="dic.reference.typography.scale.compact.small" >
      <AstroCode code={code} lang={language??"tsx"} theme={"github-light"} style="background: transparent" />
      </Box>
    </Box>
  </Box>
</Container>
<script>
  const buttons = document.querySelectorAll('[data-toggle-code]');

  buttons.forEach((button) => {
    const code = button?.parentElement?.nextElementSibling;
    
    button?.addEventListener('click', () => {
      if(code) {
        const codeElement = code as HTMLElement;
        codeElement.style.display = codeElement.style.display === 'none' ? 'block' : 'none';
      }
    });
  });
</script>