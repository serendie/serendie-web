---
import { Button, SvgIcon } from "@serendie/ui";
import { Box, Flex, styled } from "@serendie/ui/jsx";
import { Code as AstroCode } from "astro:components";
import type { BundledLanguage } from "shiki";
import { StorybookButton } from "../comopnents/StorybookButton.tsx";
import { css } from "@serendie/ui/css";

interface Props {
  title: string;
  description: string;
  code: string;
  storyUrl?: string;
  language?: BundledLanguage;
}

const {
  title, 
  description,
  code,
  storyUrl,
  language
} = Astro.props

const Container = styled('div',{
  base: {
    textStyle: "sd.system.typography.body.small_expanded",
    mb:"sd.system.dimension.spacing.threeExtraLarge",
  }
})

const SubTitle = styled('h2',{
  base: {
    textStyle: "sd.system.typography.title.large_expanded",
  }
})

const Description = styled('p',{
  base: {
    mb: "sd.system.dimension.spacing.medium",
  }
})

const StyledButton = styled('button', {
  base: {
    cursor: "pointer",
  }
})

---

<Container>
  <Flex justifyContent={"space-between"} mb="sd.system.dimension.spacing.small">
    <SubTitle>{title}</SubTitle>
    <StorybookButton href={storyUrl} />
  </Flex>
  <Description mb="sd.system.dimension.spacing.twoExtraLarge" fontSize="sd.reference.typography.scale.expanded.extraSmall">{description}</Description>
  <Box
         border={"solid"} borderColor="sd.system.color.component.outline"
         borderWidth="sd.system.dimension.border.medium"
         borderRadius='sd.system.dimension.radius.large'
         overflow='hidden'
  >
    <Box p='sd.system.dimension.spacing.threeExtraLarge' borderBottomColor="sd.system.color.component.outline" borderBottomWidth="sd.system.dimension.border.medium"> 
      <slot />
    </Box>
    <Box
    py='sd.system.dimension.spacing.extraLarge'
    px='sd.system.dimension.spacing.twoExtraLarge'
    bg="sd.reference.color.scale.gray.100"
    >
      <Flex justifyContent={"space-between"}
      py='sd.system.dimension.spacing.small' px='sd.system.dimension.spacing.extraSmall'
      >
        <StyledButton data-toggle-code display="inline-flex" alignItems={"center"} textStyle="sd.system.typography.body.medium_expanded">
          <SvgIcon icon={"chevron_right"} size={"20px"} className={css({mr:"sd.system.dimension.spacing.extraSmall"})} />
          Code
        </StyledButton>
        <StyledButton aria-label="Copy"><SvgIcon size={"20px"} icon={"clipboard_copy"}/></StyledButton>
      </Flex>
      <Box style={{"display": "none"}} pt="sd.system.dimension.spacing.medium" px="sd.system.dimension.spacing.medium" fontSize="sd.reference.typography.scale.compact.small" >
      <AstroCode code={code} lang={language??"tsx"} theme={"github-light"} style="background: transparent" />
      </Box>
    </Box>
  </Box>
</Container>
<script>
  const buttons = document.querySelectorAll('[data-toggle-code]');

  buttons.forEach((button) => {
    const code = button?.parentElement?.nextElementSibling;
    
    button?.addEventListener('click', () => {
      if(code) {
        const codeElement = code as HTMLElement;
        codeElement.style.display = codeElement.style.display === 'none' ? 'block' : 'none';
      }
    });
  });
</script>